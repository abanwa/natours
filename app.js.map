{"mappings":";;;;;;;AAAA,kBAAkB;ACAlB,kBAAkB,GAElB,gDAAgD;AAEhD,0CAA0C;AAC1C,kFAAkF;AAClF,0BAA0B;AAEnB,MAAM,4CAAa,CAAC;IACzB,SAAS,WAAW,GAClB;IACF,IAAI,MAAM,IAAI,SAAS,GAAG,CAAC;QACzB,WAAW;QACX,OAAO;QACP,8DAA8D;QAC9D,YAAY;IAId;IAEA,MAAM,SAAS,IAAI,SAAS,YAAY;IAExC,UAAU,OAAO,CAAC,CAAC;QACjB,gBAAgB;QAChB,MAAM,KAAK,SAAS,aAAa,CAAC;QAClC,GAAG,SAAS,GAAG;QAEf,aAAa;QACb,IAAI,SAAS,MAAM,CAAC;YAClB,SAAS;YACT,QAAQ;QACV,GACG,SAAS,CAAC,IAAI,WAAW,EACzB,KAAK,CAAC;QAET,YAAY;QACZ,IAAI,SAAS,KAAK,CAAC;YACjB,QAAQ;QACV,GACG,SAAS,CAAC,IAAI,WAAW,EACzB,OAAO,CAAC,CAAC,OAAO,EAAE,IAAI,GAAG,CAAC,EAAE,EAAE,IAAI,WAAW,CAAC,IAAI,CAAC,EACnD,KAAK,CAAC;QAET,gDAAgD;QAChD,OAAO,MAAM,CAAC,IAAI,WAAW;IAC/B;IAEA,IAAI,SAAS,CAAC,QAAQ;QACpB,SAAS;YACP,KAAK;YACL,QAAQ;YACR,MAAM;YACN,OAAO;QACT;IACF;AACF;;;ACxDA,kBAAkB;ACAlB,kBAAkB,GAEX,MAAM,4CAAY;IACvB,MAAM,KAAK,SAAS,aAAa,CAAC;IAClC,IAAI,IAAI,GAAG,aAAa,CAAC,WAAW,CAAC;AACvC;AAGO,MAAM,4CAAY,CAAC,MAAM,KAAK,OAAO,CAAC;IAC3C,0CAA0C;IAC1C;IACA,kBAAkB;IAClB,MAAM,SAAS,CAAC,yBAAyB,EAAE,KAAK,EAAE,EAAE,IAAI,MAAM,CAAC;IAC/D,SAAS,aAAa,CAAC,QAAQ,kBAAkB,CAAC,cAAc;IAEhE,iCAAiC;IACjC,OAAO,UAAU,CAAC,2CAAW,OAAO;AACtC;;;ADbO,MAAM,4CAAQ,OAAO,OAAO;IACjC,IAAI;QACF,MAAM,MAAM,MAAM,CAAA,GAAA,sCAAI,EAAE;YACtB,QAAQ;YACR,mDAAmD;YACnD,KAAK;YACL,MAAM;uBAAE;0BAAO;YAAS;QAC1B;QACA,QAAQ,GAAG,CAAC;QAEZ,IAAI,IAAI,IAAI,CAAC,MAAM,KAAK,WAAW;YACjC,sCAAsC;YACtC,CAAA,GAAA,yCAAQ,EAAE,WAAW;YAErB,OAAO,UAAU,CAAC;gBAChB,SAAS,MAAM,CAAC;YAClB,GAAG;QACL;IACF,EAAE,OAAO,KAAK;QACZ,oCAAoC;QACpC,CAAA,GAAA,yCAAQ,EAAE,SAAS,IAAI,QAAQ,CAAC,IAAI,CAAC,OAAO;IAC9C;AACF;AAEO,MAAM,4CAAS;IACpB,IAAI;QACF,MAAM,MAAM,MAAM,CAAA,GAAA,sCAAI,EAAE;YACtB,QAAQ;YACR,mDAAmD;YACnD,KAAK;QACP;QAEA,IAAI,IAAI,IAAI,CAAC,MAAM,KAAK,WACtB,wGAAwG;QACxG,SAAS,MAAM,CAAC;IAEpB,EAAE,OAAO,KAAK;QACZ,QAAQ,GAAG,CAAC;QACZ,CAAA,GAAA,yCAAQ,EAAE,SAAS;IACrB;AACF;;;AE5CA,oBAAoB;;AAKb,MAAM,4CAAiB,OAAO,MAAM;IACzC,IAAI;QACF,MAAM,MACJ,SAAS,aACL,CAAC,8BAA8B,CAAC,GAChC;QACN,MAAM,MAAM,MAAM,CAAA,GAAA,sCAAI,EAAE;YACtB,QAAQ;iBACR;kBACA;QACF;QAEA,IAAI,IAAI,IAAI,CAAC,MAAM,KAAK,WACtB,CAAA,GAAA,yCAAQ,EAAE,WAAW,CAAC,EAAE,KAAK,WAAW,GAAG,sBAAsB,CAAC;IAEtE,EAAE,OAAO,KAAK;QACZ,CAAA,GAAA,yCAAQ,EAAE,SAAS,IAAI,QAAQ,CAAC,IAAI,CAAC,OAAO;IAC9C;AACF;;;;;ACrBA,MAAM,+BAAS,OACb;AAGK,MAAM,4CAAW,OAAO;IAC7B,IAAI;QACF,mCAAmC;QACnC,qFAAqF;QACrF,MAAM,UAAU,MAAM,CAAA,GAAA,sCAAI,EACxB,CAAC,kCAAkC,EAAE,OAAO,CAAC;QAG/C,wBAAwB;QAExB,yDAAyD;QACzD,MAAM,6BAAO,kBAAkB,CAAC;YAC9B,WAAW,QAAQ,IAAI,CAAC,OAAO,CAAC,EAAE;QACpC;IAEA,gDAAgD;IAChD,mDAAmD;IACrD,EAAE,OAAO,KAAK;QACZ,QAAQ,GAAG,CAAC;QACZ,CAAA,GAAA,yCAAQ,EAAE,SAAS;IACrB;AACF;;;;ALnBA,eAAe;AACf,MAAM,+BAAS,SAAS,cAAc,CAAC;AACvC,MAAM,kCAAY,SAAS,aAAa,CAAC;AACzC,MAAM,kCAAY,SAAS,aAAa,CAAC;AACzC,MAAM,qCAAe,SAAS,aAAa,CAAC;AAC5C,MAAM,yCAAmB,SAAS,aAAa,CAAC;AAChD,MAAM,gCAAU,SAAS,cAAc,CAAC;AAExC,aAAa;AACb,IAAI,8BAAQ;IACV,MAAM,YAAY,KAAK,KAAK,CAAC,6BAAO,OAAO,CAAC,SAAS;IAErD,CAAA,GAAA,yCAAS,EAAE;AACb;AAEA,IAAI,iCACF,gCAAU,gBAAgB,CAAC,UAAU,CAAC;IACpC,EAAE,cAAc;IAChB,MAAM,QAAQ,SAAS,cAAc,CAAC,SAAS,KAAK;IACpD,MAAM,WAAW,SAAS,cAAc,CAAC,YAAY,KAAK;IAC1D,CAAA,GAAA,yCAAI,EAAE,OAAO;AACf;AAGF,IAAI,iCACF,gCAAU,gBAAgB,CAAC,SAAS,CAAA,GAAA,yCAAK;AAG3C,IAAI,oCACF,mCAAa,gBAAgB,CAAC,UAAU,CAAC;IACvC,EAAE,cAAc;IAChB,+EAA+E;IAC/E,MAAM,OAAO,IAAI;IACjB,kCAAkC;IAClC,KAAK,MAAM,CAAC,QAAQ,SAAS,cAAc,CAAC,QAAQ,KAAK;IACzD,KAAK,MAAM,CAAC,SAAS,SAAS,cAAc,CAAC,SAAS,KAAK;IAC3D,KAAK,MAAM,CAAC,SAAS,SAAS,cAAc,CAAC,SAAS,KAAK,CAAC,EAAE;IAC9D,CAAA,GAAA,yCAAa,EAAE,MAAM;AACvB;AAGF,IAAI,wCACF,uCAAiB,gBAAgB,CAAC,UAAU,OAAO;IACjD,EAAE,cAAc;IAChB,SAAS,aAAa,CAAC,uBAAuB,WAAW,GAAG;IAC5D,MAAM,kBAAkB,SAAS,cAAc,CAAC,oBAAoB,KAAK;IACzE,MAAM,WAAW,SAAS,cAAc,CAAC,YAAY,KAAK;IAC1D,MAAM,kBAAkB,SAAS,cAAc,CAAC,oBAAoB,KAAK;IACzE,MAAM,CAAA,GAAA,yCAAa,EACjB;yBAAE;kBAAiB;yBAAU;IAAgB,GAC7C;IAGF,SAAS,aAAa,CAAC,uBAAuB,WAAW,GAAG;IAC5D,SAAS,cAAc,CAAC,oBAAoB,KAAK,GAAG;IACpD,SAAS,cAAc,CAAC,YAAY,KAAK,GAAG;IAC5C,SAAS,cAAc,CAAC,oBAAoB,KAAK,GAAG;AACtD;AAGF,IAAI,+BACF,8BAAQ,gBAAgB,CAAC,SAAS,OAAO;IACvC,EAAE,cAAc;IAChB,EAAE,MAAM,CAAC,WAAW,GAAG;IACvB,MAAM,UAAE,MAAM,EAAE,GAAG,EAAE,MAAM,CAAC,OAAO;IACnC,MAAM,CAAA,GAAA,yCAAO,EAAE;IAEf,EAAE,MAAM,CAAC,WAAW,GAAG;AACzB;AAGF,MAAM,qCAAe,SAAS,aAAa,CAAC,QAAQ,OAAO,CAAC,KAAK;AACjE,IAAI,oCACF,CAAA,GAAA,yCAAQ,EAAE,WAAW,oCAAc","sources":["public/js/index.js","public/js/mapbox.js","public/js/login.js","public/js/alerts.js","public/js/updateSettings.js","public/js/stripe.js"],"sourcesContent":["/* eslint-disable */\r\nimport \"@babel/polyfill\";\r\nimport { displayMap } from \"./mapbox\";\r\nimport { login, logout } from \"./login\";\r\nimport { updateSettings } from \"./updateSettings\";\r\nimport { bookTour } from \"./stripe\";\r\nimport { showAlert } from \"./alerts\";\r\n\r\n// DOM ELEMENTS\r\nconst mapBox = document.getElementById(\"map\");\r\nconst loginForm = document.querySelector(\".form--login\");\r\nconst logOutBtn = document.querySelector(\".nav__el--logout\");\r\nconst userDataForm = document.querySelector(\".form-user-data\");\r\nconst userPasswordForm = document.querySelector(\".form-user-password\");\r\nconst bookBtn = document.getElementById(\"book-tour\");\r\n\r\n// DELEGATION\r\nif (mapBox) {\r\n  const locations = JSON.parse(mapBox.dataset.locations);\r\n\r\n  displayMap(locations);\r\n}\r\n\r\nif (loginForm) {\r\n  loginForm.addEventListener(\"submit\", (e) => {\r\n    e.preventDefault();\r\n    const email = document.getElementById(\"email\").value;\r\n    const password = document.getElementById(\"password\").value;\r\n    login(email, password);\r\n  });\r\n}\r\n\r\nif (logOutBtn) {\r\n  logOutBtn.addEventListener(\"click\", logout);\r\n}\r\n\r\nif (userDataForm) {\r\n  userDataForm.addEventListener(\"submit\", (e) => {\r\n    e.preventDefault();\r\n    // we will programmatically create a multipart/form-data to submit all the data\r\n    const form = new FormData();\r\n    // we will append data to the form\r\n    form.append(\"name\", document.getElementById(\"name\").value);\r\n    form.append(\"email\", document.getElementById(\"email\").value);\r\n    form.append(\"photo\", document.getElementById(\"photo\").files[0]);\r\n    updateSettings(form, \"data\");\r\n  });\r\n}\r\n\r\nif (userPasswordForm) {\r\n  userPasswordForm.addEventListener(\"submit\", async (e) => {\r\n    e.preventDefault();\r\n    document.querySelector(\".btn--save-password\").textContent = \"Updating...\";\r\n    const passwordCurrent = document.getElementById(\"password-current\").value;\r\n    const password = document.getElementById(\"password\").value;\r\n    const passwordConfirm = document.getElementById(\"password-confirm\").value;\r\n    await updateSettings(\r\n      { passwordCurrent, password, passwordConfirm },\r\n      \"password\"\r\n    );\r\n\r\n    document.querySelector(\".btn--save-password\").textContent = \"Save password\";\r\n    document.getElementById(\"password-current\").value = \"\";\r\n    document.getElementById(\"password\").value = \"\";\r\n    document.getElementById(\"password-confirm\").value = \"\";\r\n  });\r\n}\r\n\r\nif (bookBtn) {\r\n  bookBtn.addEventListener(\"click\", async (e) => {\r\n    e.preventDefault();\r\n    e.target.textContent = \"Processing...\";\r\n    const { tourId } = e.target.dataset;\r\n    await bookTour(tourId);\r\n\r\n    e.target.textContent = \"Book tour now!\";\r\n  });\r\n}\r\n\r\nconst alertMessage = document.querySelector(\"body\").dataset.alert;\r\nif (alertMessage) {\r\n  showAlert(\"success\", alertMessage, 20);\r\n}\r\n","/* eslint-disable */\r\n\r\n// console.log(\"hello from the client side :D\");\r\n\r\n// The locations will be gotten from index\r\n// const locations = JSON.parse(document.getElementById(\"map\").dataset.locations);\r\n// console.log(locations);\r\n\r\nexport const displayMap = (locations) => {\r\n  mapboxgl.accessToken =\r\n    \"pk.eyJ1IjoiYWJhbndhIiwiYSI6ImNtMG1ocnFzcTAyOWkya3NiZjEwenFhcDIifQ.6A5GAtEuoDQaMgT2bnV5xA\";\r\n  var map = new mapboxgl.Map({\r\n    container: \"map\",\r\n    style: \"mapbox://styles/mapbox/streets-v11\",\r\n    //   style: \"mapbox://styles/abanwa/cm0nl4w1300co01pjgc1keiwl\"\r\n    scrollZoom: false\r\n    //   center: [-18.113491, 34.111745],\r\n    //   zoom: 4,\r\n    //   interactive: false\r\n  });\r\n\r\n  const bounds = new mapboxgl.LngLatBounds();\r\n\r\n  locations.forEach((loc) => {\r\n    // Create marker\r\n    const el = document.createElement(\"div\");\r\n    el.className = \"marker\";\r\n\r\n    // Add marker\r\n    new mapboxgl.Marker({\r\n      element: el,\r\n      anchor: \"bottom\"\r\n    })\r\n      .setLngLat(loc.coordinates)\r\n      .addTo(map);\r\n\r\n    // Add popup\r\n    new mapboxgl.Popup({\r\n      offset: 30\r\n    })\r\n      .setLngLat(loc.coordinates)\r\n      .setHTML(`<p>Day ${loc.day}: ${loc.description}</p>`)\r\n      .addTo(map);\r\n\r\n    // Extend map bounds to include current location\r\n    bounds.extend(loc.coordinates);\r\n  });\r\n\r\n  map.fitBounds(bounds, {\r\n    padding: {\r\n      top: 200,\r\n      bottom: 150,\r\n      left: 100,\r\n      right: 100\r\n    }\r\n  });\r\n};\r\n","/* eslint-disable */\r\nimport axios from \"axios\";\r\nimport { showAlert } from \"./alerts\";\r\n\r\nexport const login = async (email, password) => {\r\n  try {\r\n    const res = await axios({\r\n      method: \"POST\",\r\n      // url: \"http://127.0.0.1:8000/api/v1/users/login\",\r\n      url: \"/api/v1/users/login\",\r\n      data: { email, password }\r\n    });\r\n    console.log(res);\r\n\r\n    if (res.data.status === \"success\") {\r\n      //   alert(\"Logged in Successfully!\");\r\n      showAlert(\"success\", \"Logged in Successfully!\");\r\n\r\n      window.setTimeout(() => {\r\n        location.assign(\"/\");\r\n      }, 1500);\r\n    }\r\n  } catch (err) {\r\n    // alert(err.response.data.message);\r\n    showAlert(\"error\", err.response.data.message);\r\n  }\r\n};\r\n\r\nexport const logout = async () => {\r\n  try {\r\n    const res = await axios({\r\n      method: \"GET\",\r\n      // url: \"http://127.0.0.1:8000/api/v1/users/logout\"\r\n      url: \"/api/v1/users/logout\"\r\n    });\r\n\r\n    if (res.data.status === \"success\") {\r\n      // with thw rue, it will reload from the SERVER. without the true, it will reload from the browser cache\r\n      location.reload(true);\r\n    }\r\n  } catch (err) {\r\n    console.log(err);\r\n    showAlert(\"error\", \"Error logging out. Try again\");\r\n  }\r\n};\r\n","/* eslint-disable */\r\n\r\nexport const hideAlert = () => {\r\n  const el = document.querySelector(\".alert\");\r\n  if (el) el.parentElement.removeChild(el);\r\n};\r\n\r\n// type is 'success' or 'error'\r\nexport const showAlert = (type, msg, time = 7) => {\r\n  // first hide the alert element that exist\r\n  hideAlert();\r\n  // show this alert\r\n  const markup = `<div class=\"alert alert--${type}\">${msg}</div>`;\r\n  document.querySelector(\"body\").insertAdjacentHTML(\"afterbegin\", markup);\r\n\r\n  // hide the alert after 5 seconds\r\n  window.setTimeout(hideAlert, time * 1000);\r\n};\r\n","/*  eslint-disable  */\r\nimport axios from \"axios\";\r\nimport { showAlert } from \"./alerts\";\r\n\r\n// type is either 'password' or 'data'\r\nexport const updateSettings = async (data, type) => {\r\n  try {\r\n    const url =\r\n      type === \"password\"\r\n        ? `/api/v1/users/updateMyPassword`\r\n        : \"/api/v1/users/updateMe\";\r\n    const res = await axios({\r\n      method: \"PATCH\",\r\n      url,\r\n      data\r\n    });\r\n\r\n    if (res.data.status === \"success\") {\r\n      showAlert(\"success\", `${type.toUpperCase()} updated successfully!`);\r\n    }\r\n  } catch (err) {\r\n    showAlert(\"error\", err.response.data.message);\r\n  }\r\n};\r\n","import axios from \"axios\";\r\nimport { showAlert } from \"./alerts\";\r\nconst stripe = Stripe(\r\n  \"pk_test_51Pw3UsCcUmpFwRwBxXc5OrzdQgpQD0yL2cakVegnmYbNDx7wjIi5GaKvRp8temNLYL7ZyXyWe3sK5EY8GqZIMBpk00RHyibIBp\"\r\n);\r\n\r\nexport const bookTour = async (tourId) => {\r\n  try {\r\n    // 1) Get checkout session from API\r\n    // this will create the checkout session in stripe base on the tourId we want to book\r\n    const session = await axios(\r\n      `/api/v1/bookings/checkout-session/${tourId}`\r\n    );\r\n\r\n    // console.log(session);\r\n\r\n    // 2) Create checkout form + process / charge credit card\r\n    await stripe.redirectToCheckout({\r\n      sessionId: session.data.session.id\r\n    });\r\n\r\n    // This will take us to the stripe checkout page\r\n    // window.location.href = session.data.session.url;\r\n  } catch (err) {\r\n    console.log(err);\r\n    showAlert(\"error\", err);\r\n  }\r\n};\r\n"],"names":[],"version":3,"file":"app.js.map","sourceRoot":"/"}